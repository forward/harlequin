Harlequin=(function(){var f=null,c=[],e=true,a="stripe",d={};var b={},g={color_class:"color",start_hue:0,end_hue:120,sat:90,lightness:70,colors:null};if(typeof jQuery!="undefined"){$.expr[":"].harlequin=function(){return true}}populateCells=function(m){if(m=="both"){c.push({index:-1,sort:f.data("sort")||"low-to-high"})}else{var h=0,n=0;var l=(m=="column")?"thead th":(m=="row")?"tbody tr":false;if(l==false){return}$(l,f).each(function(){if($(this).attr("colspan")!=undefined){var o=parseInt($(this).attr("colspan"));if($(this).hasClass(b.color_class)){for(var p=0;p<o;p++){c.push({index:h+p,sort:$(this).data("sort")||"low-to-high"})}}else{h+=o}}else{if($(this).hasClass(b.color_class)){c.push({index:h,sort:$(this).data("sort")||"low-to-high"})}}h++})}};paintCells=function(n){for(i=0,len=c.length;i<len;i++){var h=c[i],m=h.index;seg_max=null,seg_min=null,cells=[];var l=(n=="column")?$("tbody tr td:nth-child("+(m+1)+")",f):(n=="row")?$("tbody tr:nth-child("+(m+1)+")",f).find("td"):(n=="both")?$("tbody td",f):false;if(l==false){return}l.each(function(){var p=$(this);var o={orig:p.text(),value:parseFloat(p.text().replace(/[^0-9\.]+/g,"")),el:p};if(o.value.length<1){return true}if(seg_min==null){seg_min=o.value}else{if(o.value<seg_min){seg_min=o.value}}if(seg_max==null){seg_max=o.value}else{if(o.value>seg_max){seg_max=o.value}}cells.push(o)});for(j=0,jlen=cells.length;j<jlen;j++){paintCell(cells[j],seg_min,seg_max,h.sort)}}};paintCell=function(m,p,l,o){color=getColor(m.value,p,l,o);if(typeof a=="object"){for(var n=0,h=a.length;n<h;n++){d[a[n]](m,p,l,o,color,b)}}else{d[a](m,p,l,o,color,b)}};registerPainter=function(h,l){if(typeof l!="function"){return}d[h]=l};getColor=function(s,l,r,m){var h;if(b.colors!=null&&typeof b.colors=="object"){var q=b.colors.length,p=Math.floor(((s-l)/(r-l))*q)-1;if(p==-1){p=0}h=b.colors[p]}else{var n=b.end_hue-b.start_hue;if(m=="high-to-low"){var o=Math.ceil(b.end_hue-(((s-l)/(r-l))*n))}else{var o=Math.ceil(b.start_hue+(((s-l)/(r-l))*n))}if(l==r){o=Math.ceil(n/2)}h="hsl("+o+","+b.sat+"%,"+b.lightness+"%)";if(!e){h=hsl2hex(o,b.sat,b.lightness)}}return h};testHsl=function(){var h=document.createElement("harlequin");h.style.cssText="background-color:hsla(120,40%,100%,.5)";return !!~(""+h.style.backgroundColor).indexOf("rgba")||!!~(""+h.style.backgroundColor).indexOf("hsla")};hsl2hex=function(r,q,m){r=(r%360)/360;q=q/100;m=m/100;if(q==0){m=Math.round(m*255);return{r:m,g:m,b:m}}var o=m>=0.5?((m+q)-(m*q)):m*(1+q);var p=(2*m)-o;return"#"+(Math.round(n(r-1/3)*255)|Math.round(n(r)*255)<<8|Math.round(n(r+1/3)*255)<<16).toString(16);function n(l){l=l<0?l+1:(l>1?l-1:l);if(l*6<1){return p+(o-p)*l*6}else{if(l*2<1){return o}else{if(l*3<2){return p+(o-p)*(2/3-l)*6}else{return p}}}}};reset=function(){c=[];b={}};paint=function(h,n,m,l){reset();f=$("#"+n);a=h||"stripe";if(l!=undefined){for(k in g){b[k]=(l[k]!=undefined)?l[k]:g[k]}}else{b=g}populateCells(m);paintCells(m)};e=testHsl();registerPainter("stripe",function(l,o,h,n,m){l.el.css("background-color",m)});registerPainter("bar",function(l,n,h,m){var p=document.createElement("span"),o=document.createElement("span");p.innerHTML=l.orig;p.style.background=color;p.style.width=Math.floor(((l.value-n)/(h-n))*100)+"%";p.style.display="inline-block";p.style.textAlign="center";l.el.textAlign="left";l.el[0].innerHTML="";l.el[0].appendChild(p)});registerPainter("dot",function(l,o,h,n){var m=document.createElement("span"),p=document.createElement("span");max_radius=Math.floor(l.el.height()*4),radius=Math.floor(((l.value-o)/(h-o))*max_radius)+3;m.innerHTML=l.orig;m.style.background=color;m.style.display="inline-block";m.style.textAlign="center";m.style.width=m.style.height=(radius)+"px";m.style.borderRadius=m.style.MozBorderRadius=m.style.WebkitBorderRadius="999px";m.style.position="absolute";m.style.zIndex=0;p.style.zIndex=1;p.style.display="inline-block";p.style.lineHeight=l.el.height();l.el[0].style.position="relative";l.el[0].innerHTML="";l.el[0].appendChild(m);l.el[0].appendChild(p)});return{paint:paint,register:registerPainter,stripe:function(m,l,h){paint("stripe",m,l,h)},bar:function(m,l,h){paint("bar",m,l,h)}}})();
