Harlequin=function(){var a=null,b=[],c=true,d="stripe",e={};var f={},g={color_class:"color",start_hue:0,end_hue:120,sat:90,lightness:70,colors:null};if(typeof jQuery!="undefined"){$.expr[":"].harlequin=function(){return true}}populateCells=function(c){if(c=="both"){b.push({index:-1,sort:a.data("sort")||"low-to-high"})}else{var d=0,e=0;var g=c=="column"?"thead th":c=="row"?"tbody tr":false;if(g==false)return;$(g,a).each(function(){if($(this).attr("colspan")!=undefined){var a=parseInt($(this).attr("colspan"));if($(this).hasClass(f.color_class)){for(var c=0;c<a;c++){b.push({index:d+c,sort:$(this).data("sort")||"low-to-high"})}}else{d+=a}}else{if($(this).hasClass(f.color_class)){b.push({index:d,sort:$(this).data("sort")||"low-to-high"})}}d++})}};paintCells=function(c){for(i=0,len=b.length;i<len;i++){var d=b[i],e=d.index;seg_max=null,seg_min=null,cells=[];var f=c=="column"?$("tbody tr td:nth-child("+(e+1)+")",a):c=="row"?$("tbody tr:nth-child("+(e+1)+")",a).find("td"):c=="both"?$("tbody td",a):false;if(f==false)return;f.each(function(){var a=$(this);var b={orig:a.text(),value:parseFloat(a.text().replace(",","")),el:a};if(b.value.length<1){return true}if(seg_min==null){seg_min=b.value}else if(b.value<seg_min){seg_min=b.value}if(seg_max==null){seg_max=b.value}else if(b.value>seg_max){seg_max=b.value}cells.push(b)});for(j=0,jlen=cells.length;j<jlen;j++){paintCell(cells[j],seg_min,seg_max,d.sort)}}};paintCell=function(a,b,c,g){color=getColor(a.value,b,c,g);if(typeof d=="object"){for(var h=0,i=d.length;h<i;h++){e[d[h]](a,b,c,g,color,f)}}else{e[d](a,b,c,g,color,f)}};registerPainter=function(a,b){if(typeof b!="function")return;e[a]=b};getColor=function(a,b,d,e){var g;if(f.colors!=null&&typeof f.colors=="object"){var h=f.colors.length,i=Math.floor((a-b)/(d-b)*h)-1;if(i==-1)i=0;g=f.colors[i]}else{var j=f.end_hue-f.start_hue;if(e=="high-to-low"){var k=Math.ceil(f.end_hue-(a-b)/(d-b)*j)}else{var k=Math.ceil(f.start_hue+(a-b)/(d-b)*j)}if(b==d)k=Math.ceil(j/2);g="hsl("+k+","+f.sat+"%,"+f.lightness+"%)";if(!c){g=hsl2hex(k,f.sat,f.lightness)}}return g};testHsl=function(){var a=document.createElement("harlequin");a.style.cssText="background-color:hsla(120,40%,100%,.5)";return!!~(""+a.style.backgroundColor).indexOf("rgba")||!!~(""+a.style.backgroundColor).indexOf("hsla")};hsl2hex=function(a,b,c){function f(a){a=a<0?a+1:a>1?a-1:a;if(a*6<1)return e+(d-e)*a*6;else if(a*2<1)return d;else if(a*3<2)return e+(d-e)*(2/3-a)*6;else return e}a=a%360/360;b=b/100;c=c/100;if(b==0){c=Math.round(c*255);return{r:c,g:c,b:c}}var d=c>=.5?c+b-c*b:c*(1+b);var e=2*c-d;return"#"+(Math.round(f(a-1/3)*255)|Math.round(f(a)*255)<<8|Math.round(f(a+1/3)*255)<<16).toString(16)};reset=function(){b=[];f={}};paint=function(b,c,e,h){reset();a=$("#"+c);d=b||"stripe";if(h!=undefined){for(k in g){f[k]=h[k]!=undefined?h[k]:g[k]}}else{f=g}populateCells(e);paintCells(e)};c=testHsl();registerPainter("stripe",function(a,b,c,d,e){a.el.css("background-color",e)});registerPainter("bar",function(a,b,c,d){var e=document.createElement("span"),f=document.createElement("span");e.innerHTML=a.orig;e.style.background=color;e.style.width=Math.floor((a.value-b)/(c-b)*100)+"%";e.style.display="inline-block";e.style.textAlign="center";a.el.textAlign="left";a.el[0].innerHTML="";a.el[0].appendChild(e)});registerPainter("dot",function(a,b,c,d){var e=document.createElement("span"),f=document.createElement("span");max_radius=Math.floor(a.el.height()*4),radius=Math.floor((a.value-b)/(c-b)*max_radius)+3;e.innerHTML=a.orig;e.style.background=color;e.style.display="inline-block";e.style.textAlign="center";e.style.width=e.style.height=radius+"px";e.style.borderRadius=e.style.MozBorderRadius=e.style.WebkitBorderRadius="999px";e.style.position="absolute";e.style.zIndex=0;f.style.zIndex=1;f.style.display="inline-block";f.style.lineHeight=a.el.height();a.el[0].style.position="relative";a.el[0].innerHTML="";a.el[0].appendChild(e);a.el[0].appendChild(f)});return{paint:paint,register:registerPainter,stripe:function(a,b,c){paint("stripe",a,b,c)},bar:function(a,b,c){paint("bar",a,b,c)}}}()